{% extends "base.html" %}
{% load json_script %}

{% block title %}Analytics | Debuttend CMS{% endblock %}

{% block extra_head %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js" integrity="sha384-eu8ApX2HFqRSbVSSMzdON3NofM8JrIoVNewc19hXtOD87o5iV/mQJu1WDVYj1ibB" crossorigin="anonymous" defer></script>
{% endblock %}

{% block content %}
<section class="container mx-auto px-4 py-16">
  <header class="mb-8">
    <h1 class="text-3xl font-bold">Analytics Overview</h1>
    <p class="text-gray-600">Real-time insights into content performance and system health.</p>
  </header>

  <div class="grid gap-6 lg:grid-cols-3">
    <section class="rounded border border-gray-200 bg-white p-6 shadow lg:col-span-2">
      <h2 class="text-xl font-semibold">Traffic (Last 7 Days)</h2>
      <canvas id="trafficChart" class="mt-4 h-64 w-full"></canvas>
      {{ traffic|json_script:"traffic-data" }}
    </section>
    <section class="rounded border border-gray-200 bg-white p-6 shadow">
      <h2 class="text-xl font-semibold">System Health</h2>
      <ul class="mt-4 space-y-2 text-gray-700">
        <li><span class="font-medium">Uptime:</span> {{ system_health.uptime }}</li>
        <li><span class="font-medium">Average Response Time:</span> {{ system_health.avg_response_time }}</li>
        <li><span class="font-medium">Error Rate:</span> {{ system_health.error_rate }}</li>
      </ul>
    </section>
  </div>

  <section class="mt-8 rounded border border-gray-200 bg-white p-6 shadow">
    <h2 class="text-xl font-semibold">Top Performing Content</h2>
    <table class="mt-4 w-full table-auto">
      <thead>
        <tr class="text-left text-sm uppercase tracking-wide text-gray-500">
          <th class="py-2">Title</th>
          <th class="py-2">Views</th>
        </tr>
      </thead>
      <tbody>
        {% for item in top_content %}
          <tr class="border-t border-gray-100">
            <td class="py-2">{{ item.title }}</td>
            <td class="py-2">{{ item.views }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</section>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('trafficChart');
    const data = JSON.parse(document.getElementById('traffic-data').textContent);
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.map(item => item.date),
        datasets: [{
          label: 'Visits',
          data: data.map(item => item.visits),
          fill: false,
          borderColor: '#4f46e5',
          tension: 0.3,
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: true } },
        scales: { y: { beginAtZero: true } }
      }
    });
  });
</script>
{% endblock %}
